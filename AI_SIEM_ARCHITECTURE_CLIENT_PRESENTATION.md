# SecOps AI Platform - High-Level Architecture
**AI-First Security Operations Platform**

*Last Updated: November 16, 2025*

---

## Executive Summary

SecOps AI Platform is an **AI-first SIEM** that transforms traditional security operations by:
- **Auto-triaging 40-60%** of false positive alerts
- **Detecting multi-stage attacks** (campaigns) that span hours/days
- **Recommending investigation playbooks** from organizational memory
- **Predicting investigation time** for resource planning
- **Learning continuously** from every analyst action

**Key Differentiator:** The system gets smarter with every alert it processes and every investigation analysts complete.

---

## ğŸ—ï¸ System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DATA SOURCES (13 Types)                                  â”‚
â”‚  AWS CloudTrail â”‚ Azure AD â”‚ Okta â”‚ GitHub â”‚ Slack â”‚ Windows â”‚ Linux â”‚ Network   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   VECTOR PIPELINE       â”‚
                    â”‚  (Parse/Normalize/      â”‚
                    â”‚   GeoIP/Threat Intel)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   KAFKA (29 Topics)     â”‚
                    â”‚  security-events â”‚      â”‚
                    â”‚  security-auth   â”‚      â”‚
                    â”‚  security-networkâ”‚      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DETECTION      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ EMBEDDING       â”‚
â”‚ ENGINE         â”‚      Semantic Enrichment      â”‚ SERVICE         â”‚
â”‚                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
â”‚ (8-Phase AI    â”‚      Playbook Search          â”‚ (Vector Search  â”‚
â”‚  Enrichment)   â”‚                               â”‚  & Learning)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                                  â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”œâ”€â”¤ ENTITY GRAPH SERVICE (Neo4j)              â”‚  â”‚
        â”‚ â”‚ - User behavior baselines                 â”‚  â”‚
        â”‚ â”‚ - IP/Host relationship graphs             â”‚  â”‚
        â”‚ â”‚ - Risk scoring (0-100)                    â”‚  â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                                                  â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â””â”€â”¤ STORAGE LAYER                              â”‚  â”‚
          â”‚ PostgreSQL   â”‚ Elasticsearch â”‚ Qdrant      â”‚â—„â”€â”˜
          â”‚ (Structured) â”‚ (Search)      â”‚ (Vectors)   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   AI ORCHESTRATOR               â”‚
        â”‚   (Claude Sonnet 4)             â”‚
        â”‚   - Auto-Investigation          â”‚
        â”‚   - Campaign Analysis           â”‚
        â”‚   - Chat Interface (19 tools)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Complete Data Flow: From Alert to Investigation

### Example Scenario: AWS Credential Compromise

Let's trace a real-world attack through the entire system:

**Attack Timeline:**
1. **10:00 AM** - Attacker steals AWS credentials
2. **10:05 AM** - Multiple failed login attempts from Russia
3. **10:12 AM** - Successful login from new IP
4. **10:15 AM** - Privilege escalation (assume admin role)
5. **10:18 AM** - Unusual S3 bucket access

---

### Phase 1-4: Detection Engine (Core Processing)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 1: EVENT CONSUMPTION & SIGMA DETECTION                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Event from Kafka:                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ source: aws-cloudtrail                                      â”‚            â”‚
â”‚  â”‚ event_type: ConsoleLogin                                    â”‚            â”‚
â”‚  â”‚ user: admin@company.com                                     â”‚            â”‚
â”‚  â”‚ source_ip: 185.220.101.45 (Russia)                          â”‚            â”‚
â”‚  â”‚ result: SUCCESS                                             â”‚            â”‚
â”‚  â”‚ timestamp: 2025-11-16 10:12:00                              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  â†“ Run Sigma Rules (300+ rules)                                             â”‚
â”‚                                                                              â”‚
â”‚  âœ“ MATCH: "AWS Console Login from Suspicious Country"                       â”‚
â”‚  âœ“ MATCH: "AWS Login Outside Business Hours"                                â”‚
â”‚                                                                              â”‚
â”‚  â†’ Create Initial Alert                                                      â”‚
â”‚     alert_id: ALT-98765                                                      â”‚
â”‚     title: "Suspicious AWS Console Login"                                   â”‚
â”‚     severity: high (from Sigma rule)                                        â”‚
â”‚     confidence: 0.65 (initial)                                              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 2: SEMANTIC ENRICHMENT (AI LEARNING) â­                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Detection Engine â†’ Embedding Service:                                       â”‚
â”‚  POST /alerts/search/semantic                                                â”‚
â”‚  {                                                                           â”‚
â”‚    "query": "Suspicious AWS Console Login admin@company.com Russia",        â”‚
â”‚    "tenant_id": "tenant-123",                                                â”‚
â”‚    "top_k": 10,                                                              â”‚
â”‚    "similarity_threshold": 0.80                                              â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  â†“ Embedding Service searches Qdrant 'tenant_123_alerts' collection         â”‚
â”‚                                                                              â”‚
â”‚  Found 10 similar alerts:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Alert ID â”‚ Similarity â”‚ Resolution â”‚ Outcome              â”‚             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  â”‚ ALT-9101 â”‚   0.92     â”‚ resolved   â”‚ false_positive       â”‚             â”‚
â”‚  â”‚ ALT-8234 â”‚   0.89     â”‚ resolved   â”‚ false_positive       â”‚             â”‚
â”‚  â”‚ ALT-7567 â”‚   0.88     â”‚ resolved   â”‚ false_positive       â”‚             â”‚
â”‚  â”‚ ALT-6891 â”‚   0.87     â”‚ resolved   â”‚ false_positive       â”‚             â”‚
â”‚  â”‚ ALT-5234 â”‚   0.86     â”‚ resolved   â”‚ false_positive       â”‚             â”‚
â”‚  â”‚ ALT-4123 â”‚   0.85     â”‚ resolved   â”‚ true_positive        â”‚             â”‚
â”‚  â”‚ ALT-3456 â”‚   0.84     â”‚ resolved   â”‚ false_positive       â”‚             â”‚
â”‚  â”‚ ALT-2789 â”‚   0.83     â”‚ resolved   â”‚ false_positive       â”‚             â”‚
â”‚  â”‚ ALT-1567 â”‚   0.82     â”‚ resolved   â”‚ false_positive       â”‚             â”‚
â”‚  â”‚ ALT-0234 â”‚   0.81     â”‚ resolved   â”‚ false_positive       â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                              â”‚
â”‚  ğŸ¤– AI Auto-Dismiss Logic:                                                   â”‚
â”‚     - 10 similar alerts found (â‰¥10 required) âœ“                              â”‚
â”‚     - 9 were false positives = 90% FP rate (â‰¥85% required) âœ“                â”‚
â”‚     - Best similarity: 0.92 (â‰¥90% required) âœ“                               â”‚
â”‚                                                                              â”‚
â”‚     âŒ BUT WAIT! Additional Context Check...                                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 3: POSTGRESQL ALERT CREATION                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Insert into alerts table:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ alert_id: ALT-98765                                         â”‚            â”‚
â”‚  â”‚ title: "Suspicious AWS Console Login"                       â”‚            â”‚
â”‚  â”‚ severity: high                                              â”‚            â”‚
â”‚  â”‚ confidence: 0.92 (updated from semantic enrichment)         â”‚            â”‚
â”‚  â”‚ status: new (NOT auto-dismissed yet)                        â”‚            â”‚
â”‚  â”‚ similar_alerts: {                                           â”‚            â”‚
â”‚  â”‚   "total": 10,                                              â”‚            â”‚
â”‚  â”‚   "fp_count": 9,                                            â”‚            â”‚
â”‚  â”‚   "tp_count": 1,                                            â”‚            â”‚
â”‚  â”‚   "fp_percentage": 90,                                      â”‚            â”‚
â”‚  â”‚   "similar_alerts": [...]                                   â”‚            â”‚
â”‚  â”‚ }                                                           â”‚            â”‚
â”‚  â”‚ auto_dismiss_confidence: 0.90                               â”‚            â”‚
â”‚  â”‚ auto_dismiss_reasoning: "9/10 similar alerts were FP..."    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 4: DECISION POINT                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Should we auto-dismiss? Let's check behavioral context first...            â”‚
â”‚                                                                              â”‚
â”‚  âŒ DON'T auto-dismiss yet â†’ Continue to Phase 5-7 for full enrichment      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Phase 5-7: Deep Enrichment (Behavioral + Threat Intel + UEBA)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 5: BEHAVIORAL CONTEXT (Entity Graph Service + Neo4j)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Detection Engine â†’ Entity Graph Service:                                    â”‚
â”‚  POST /api/v1/entity-graph/enrich                                            â”‚
â”‚  {                                                                           â”‚
â”‚    "user": "admin@company.com",                                              â”‚
â”‚    "source_ip": "185.220.101.45",                                            â”‚
â”‚    "tenant_id": "tenant-123"                                                 â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  Entity Graph Service queries Neo4j:                                         â”‚
â”‚                                                                              â”‚
â”‚  ğŸ” User Behavioral Analysis:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ User: admin@company.com                                     â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ Normal Behavior (Last 30 days):                             â”‚            â”‚
â”‚  â”‚  - Login countries: USA (98%), Canada (2%)                  â”‚            â”‚
â”‚  â”‚  - Login times: 9 AM - 6 PM EST                             â”‚            â”‚
â”‚  â”‚  - Login IPs: 5 unique IPs (all USA)                        â”‚            â”‚
â”‚  â”‚  - Avg logins/day: 2.3                                      â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ Current Event Anomalies:                                    â”‚            â”‚
â”‚  â”‚  âš ï¸ First login from Russia (NEVER seen before)             â”‚            â”‚
â”‚  â”‚  âš ï¸ Login at 10:12 AM (unusual time - user in USA/EST)      â”‚            â”‚
â”‚  â”‚  âš ï¸ New IP never seen in 90-day history                     â”‚            â”‚
â”‚  â”‚  âš ï¸ 5 failed attempts before success (unusual)              â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ Risk Score Calculation:                                     â”‚            â”‚
â”‚  â”‚  Base: 30 (AWS login)                                       â”‚            â”‚
â”‚  â”‚  + 25 (new country)                                         â”‚            â”‚
â”‚  â”‚  + 20 (failed attempts)                                     â”‚            â”‚
â”‚  â”‚  + 15 (unusual time)                                        â”‚            â”‚
â”‚  â”‚  = 90/100 CRITICAL RISK âš ï¸                                  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  ğŸ” IP Relationship Graph:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ IP: 185.220.101.45                                          â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ Connections in last 24 hours:                               â”‚            â”‚
â”‚  â”‚  - 12 different users attempted login from this IP          â”‚            â”‚
â”‚  â”‚  - 3 successful logins (unusual pattern)                    â”‚            â”‚
â”‚  â”‚  - IP first seen: 3 hours ago                               â”‚            â”‚
â”‚  â”‚  - Total events from IP: 47                                 â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ âš ï¸ PATTERN: Credential stuffing attack detected             â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  Alert enrichment updated:                                                   â”‚
â”‚  behavioral_context = {                                                      â”‚
â”‚    "user_risk_score": 90,                                                    â”‚
â”‚    "is_new_country": true,                                                   â”‚
â”‚    "is_new_ip": true,                                                        â”‚
â”‚    "failed_attempts_before_success": 5,                                      â”‚
â”‚    "ip_suspicious_pattern": "credential_stuffing",                           â”‚
â”‚    "anomaly_score": 0.95                                                     â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  ğŸš¨ CRITICAL FINDING: Despite 90% historical FP rate,                        â”‚
â”‚     behavioral context indicates TRUE POSITIVE!                              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 6: IOC THREAT INTELLIGENCE                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Extract IOCs from alert:                                                    â”‚
â”‚  - IP: 185.220.101.45                                                        â”‚
â”‚  - User: admin@company.com                                                   â”‚
â”‚                                                                              â”‚
â”‚  ğŸ” Internal IOC Database (Qdrant 'iocs' collection):                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Search: IP "185.220.101.45" (exact match)                   â”‚            â”‚
â”‚  â”‚ âŒ Not found                                                 â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ Search: Similar IPs (semantic search)                       â”‚            â”‚
â”‚  â”‚ âœ“ Found: 185.220.101.* subnet                               â”‚            â”‚
â”‚  â”‚   - 185.220.101.23 (malicious, seen 2 days ago)             â”‚            â”‚
â”‚  â”‚   - 185.220.101.67 (malicious, seen 1 week ago)             â”‚            â”‚
â”‚  â”‚   - Tagged as: "tor_exit_node", "credential_abuse"          â”‚            â”‚
â”‚  â”‚   - Confidence: 0.85                                        â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  ğŸ” External Threat Feeds:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ AbuseIPDB: 185.220.101.45                                   â”‚            â”‚
â”‚  â”‚  - Abuse Score: 87/100                                      â”‚            â”‚
â”‚  â”‚  - Reports: 23 in last 30 days                              â”‚            â”‚
â”‚  â”‚  - Categories: SSH brute force, credential stuffing         â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ VirusTotal: 185.220.101.45                                  â”‚            â”‚
â”‚  â”‚  - Malicious: 12/92 vendors                                 â”‚            â”‚
â”‚  â”‚  - Community Score: -15                                     â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ AlienVault OTX: 185.220.101.45                              â”‚            â”‚
â”‚  â”‚  - Found in 3 pulses                                        â”‚            â”‚
â”‚  â”‚  - Tags: "botnet", "credential_theft"                       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  Combined Threat Verdict:                                                    â”‚
â”‚  verdict = {                                                                 â”‚
â”‚    "ioc_type": "ip",                                                         â”‚
â”‚    "ioc_value": "185.220.101.45",                                            â”‚
â”‚    "is_malicious": true,                                                     â”‚
â”‚    "confidence": 0.89,  # 70% internal + 30% external weighted               â”‚
â”‚    "threat_types": ["credential_stuffing", "botnet"],                        â”‚
â”‚    "sources": ["internal_ioc_db", "abuseipdb", "virustotal", "otx"]         â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  Alert updated:                                                              â”‚
â”‚  threat_intel_results = [verdict]                                            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 7: ML/UEBA ANALYSIS                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Detection Engine â†’ Embedding Service:                                       â”‚
â”‚  POST /baselines/check-anomaly                                               â”‚
â”‚  {                                                                           â”‚
â”‚    "entity_type": "user",                                                    â”‚
â”‚    "entity_value": "admin@company.com",                                      â”‚
â”‚    "features": {                                                             â”‚
â”‚      "login_hour": 10,                                                       â”‚
â”‚      "login_country": "Russia",                                              â”‚
â”‚      "failed_attempts": 5,                                                   â”‚
â”‚      "source_ip_reputation": -15                                             â”‚
â”‚    }                                                                         â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  Embedding Service loads baseline from Qdrant 'entity_baselines':           â”‚
â”‚                                                                              â”‚
â”‚  ğŸ” Behavioral Baseline for admin@company.com:                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Last updated: 2025-11-15 (weekly refresh)                   â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ Statistical Baseline:                                       â”‚            â”‚
â”‚  â”‚  - login_hour: mean=13.2, std=2.1                           â”‚            â”‚
â”‚  â”‚    Current: 10 â†’ z-score = -1.52 (unusual but not extreme) â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚  - failed_attempts: mean=0.1, std=0.3                       â”‚            â”‚
â”‚  â”‚    Current: 5 â†’ z-score = 16.3 ğŸš¨ EXTREME ANOMALY           â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚  - login_country: 98% USA, 2% Canada                        â”‚            â”‚
â”‚  â”‚    Current: Russia â†’ NEVER SEEN (100% anomaly)              â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ Semantic Similarity:                                        â”‚            â”‚
â”‚  â”‚  - Current behavior vector distance: 0.12                   â”‚            â”‚
â”‚  â”‚    (0.0 = identical, 1.0 = completely different)            â”‚            â”‚
â”‚  â”‚  - Threshold: 0.15                                          â”‚            â”‚
â”‚  â”‚  - Similarity: 88% (within normal range)                    â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ Combined Anomaly Score:                                     â”‚            â”‚
â”‚  â”‚  - Statistical: 0.98 (extreme)                              â”‚            â”‚
â”‚  â”‚  - Semantic: 0.12 (normal)                                  â”‚            â”‚
â”‚  â”‚  - Weighted: (0.7 * 0.98) + (0.3 * 0.12) = 0.72             â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ âš ï¸ VERDICT: HIGH ANOMALY (threshold: 0.6)                   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  Alert updated:                                                              â”‚
â”‚  ueba_results = {                                                            â”‚
â”‚    "baseline_available": true,                                               â”‚
â”‚    "anomaly_score": 0.72,                                                    â”‚
â”‚    "is_anomalous": true,                                                     â”‚
â”‚    "anomaly_reasons": [                                                      â”‚
â”‚      "Extreme failed attempts (16.3 std deviations)",                        â”‚
â”‚      "Login from never-seen country (Russia)",                               â”‚
â”‚      "High statistical anomaly score"                                        â”‚
â”‚    ]                                                                         â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  ğŸ¯ FINAL DECISION: DO NOT AUTO-DISMISS                                      â”‚
â”‚     Despite 90% historical FP rate, behavioral + threat intel + UEBA         â”‚
â”‚     all indicate TRUE POSITIVE. Create incident!                             â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Phase 8: Correlation & Incident Creation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 8: CORRELATION & INCIDENT CREATION                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Alert Summary (ALT-98765):                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ severity: high â†’ critical (escalated)                       â”‚            â”‚
â”‚  â”‚ confidence: 0.92                                            â”‚            â”‚
â”‚  â”‚ risk_score: 90/100                                          â”‚            â”‚
â”‚  â”‚ anomaly_score: 0.72                                         â”‚            â”‚
â”‚  â”‚ ioc_malicious: true (0.89 confidence)                       â”‚            â”‚
â”‚  â”‚ status: new                                                 â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ Enrichments:                                                â”‚            â”‚
â”‚  â”‚  âœ“ Similar alerts (10 found, 90% historical FP)             â”‚            â”‚
â”‚  â”‚  âœ“ Behavioral context (90/100 risk, new country/IP)         â”‚            â”‚
â”‚  â”‚  âœ“ Threat intel (malicious IP confirmed)                    â”‚            â”‚
â”‚  â”‚  âœ“ UEBA (0.72 anomaly score)                                â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  ğŸ” Check for related alerts (last 24 hours):                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Query PostgreSQL:                                           â”‚            â”‚
â”‚  â”‚  WHERE user = 'admin@company.com'                           â”‚            â”‚
â”‚  â”‚    AND created_at > NOW() - INTERVAL '24 hours'             â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ Found 4 related alerts:                                     â”‚            â”‚
â”‚  â”‚  1. ALT-98761 (10:00 AM) - Multiple failed SSH attempts     â”‚            â”‚
â”‚  â”‚  2. ALT-98762 (10:05 AM) - Brute force detection            â”‚            â”‚
â”‚  â”‚  3. ALT-98764 (10:15 AM) - Privilege escalation detected    â”‚            â”‚
â”‚  â”‚  4. ALT-98765 (10:12 AM) - Suspicious AWS Console Login     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  ğŸ¤– Check Correlation Rules (learned from past incidents):                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Rule ID: CORR-0042                                          â”‚            â”‚
â”‚  â”‚ Name: "AWS Credential Compromise Pattern"                   â”‚            â”‚
â”‚  â”‚ Learned from: 12 similar past incidents                     â”‚            â”‚
â”‚  â”‚ Confidence: 0.88                                            â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ Conditions:                                                 â”‚            â”‚
â”‚  â”‚  âœ“ Failed login attempts (â‰¥3 in 10 min)                     â”‚            â”‚
â”‚  â”‚  âœ“ Successful login from new IP                             â”‚            â”‚
â”‚  â”‚  âœ“ Privilege escalation within 30 min                       â”‚            â”‚
â”‚  â”‚  âœ“ User risk score > 80                                     â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ âœ“ ALL CONDITIONS MET â†’ CREATE INCIDENT                      â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“ Create Incident:                                                         â”‚
â”‚  INSERT INTO incidents (                                                     â”‚
â”‚    incident_id: "INC-54321",                                                 â”‚
â”‚    title: "AWS Credential Compromise - admin@company.com",                   â”‚
â”‚    description: "Multi-stage attack detected: brute force â†’ login â†’ privesc",â”‚
â”‚    severity: critical,                                                       â”‚
â”‚    risk_score: 95,                                                           â”‚
â”‚    status: pending,  # Triggers auto-investigation!                          â”‚
â”‚    alert_ids: [ALT-98761, ALT-98762, ALT-98764, ALT-98765],                  â”‚
â”‚    affected_users: ["admin@company.com"],                                    â”‚
â”‚    affected_ips: ["185.220.101.45"],                                         â”‚
â”‚    mitre_tactics: ["Initial Access", "Credential Access", "Privilege Esc"],  â”‚
â”‚    mitre_techniques: ["T1078", "T1110", "T1548"],                            â”‚
â”‚    correlation_rule_id: "CORR-0042",                                         â”‚
â”‚    created_at: "2025-11-16 10:18:00"                                         â”‚
â”‚  )                                                                           â”‚
â”‚                                                                              â”‚
â”‚  âœ… Incident created!                                                        â”‚
â”‚                                                                              â”‚
â”‚  ğŸš¨ Severity = critical â†’ AUTO-TRIGGER AI INVESTIGATION                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### AI Investigation Flow (AI Orchestrator + Claude)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI ORCHESTRATOR: AUTO-INVESTIGATION                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Detection Engine â†’ AI Orchestrator:                                         â”‚
â”‚  POST /api/v1/investigations/incident/INC-54321/investigate                  â”‚
â”‚  {                                                                           â”‚
â”‚    "incident_id": "INC-54321",                                               â”‚
â”‚    "tenant_id": "tenant-123",                                                â”‚
â”‚    "trigger": "auto"                                                         â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: GATHER CONTEXT (5 Data Sources) - 2-3 seconds                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ContextGatherer runs parallel API calls:                                    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ 1. Elasticsearch (Raw Events)                            â”‚              â”‚
â”‚  â”‚    GET /security-events/_search                          â”‚              â”‚
â”‚  â”‚    â†’ Found 47 events for admin@company.com (last 24h)    â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ 2. Neo4j/Entity Graph (Behavioral Analytics)             â”‚              â”‚
â”‚  â”‚    POST /entity-graph-service/api/v1/users/analyze       â”‚              â”‚
â”‚  â”‚    â†’ User risk: 90/100                                   â”‚              â”‚
â”‚  â”‚    â†’ Behavioral anomalies: new_country, failed_attempts  â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ 3. Threat Intel Service (IOC Reputation)                 â”‚              â”‚
â”‚  â”‚    GET /threat-intel/api/v1/ip/185.220.101.45            â”‚              â”‚
â”‚  â”‚    â†’ Malicious (0.89 confidence)                         â”‚              â”‚
â”‚  â”‚    â†’ Tags: credential_stuffing, botnet                   â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ 4. Embedding Service (Similar Alerts)                    â”‚              â”‚
â”‚  â”‚    POST /embedding-service/api/v1/alerts/search/semantic â”‚              â”‚
â”‚  â”‚    â†’ 10 similar alerts (90% historical FP)               â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ 5. Detection Engine (Related Alerts)                     â”‚              â”‚
â”‚  â”‚    GET /detection-engine/api/v1/alerts?user=admin@...    â”‚              â”‚
â”‚  â”‚    â†’ 4 related alerts in same timeframe                  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                              â”‚
â”‚  âœ“ Context gathering complete (2.3 seconds)                                 â”‚
â”‚    - 5/5 sources successful                                                  â”‚
â”‚    - Total data points: 142                                                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: BUILD ATTACK TIMELINE                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Merge events from all sources into chronological timeline:                  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ 10:00:15 - Failed SSH login (source_ip: 185.220.101.45)    â”‚            â”‚
â”‚  â”‚ 10:01:23 - Failed SSH login (source_ip: 185.220.101.45)    â”‚            â”‚
â”‚  â”‚ 10:02:45 - Failed SSH login (source_ip: 185.220.101.45)    â”‚            â”‚
â”‚  â”‚ 10:05:12 - Failed SSH login (source_ip: 185.220.101.45)    â”‚            â”‚
â”‚  â”‚ 10:08:34 - Failed SSH login (source_ip: 185.220.101.45)    â”‚            â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚            â”‚
â”‚  â”‚ 10:12:07 - âœ“ Successful AWS Console login                  â”‚            â”‚
â”‚  â”‚            user: admin@company.com                          â”‚            â”‚
â”‚  â”‚            source_ip: 185.220.101.45 (Russia)               â”‚            â”‚
â”‚  â”‚            user_agent: Mozilla/5.0 (Windows NT 10.0)        â”‚            â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚            â”‚
â”‚  â”‚ 10:15:23 - AssumeRole API call                             â”‚            â”‚
â”‚  â”‚            role: arn:aws:iam::123456:role/AdminRole         â”‚            â”‚
â”‚  â”‚            result: SUCCESS                                  â”‚            â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚            â”‚
â”‚  â”‚ 10:18:45 - S3 GetObject (sensitive-data-bucket)            â”‚            â”‚
â”‚  â”‚            objects: 47 files accessed                       â”‚            â”‚
â”‚  â”‚            size: 2.3 GB downloaded                          â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: SEARCH SIMILAR PAST INVESTIGATIONS (LEARNING!) â­                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  AI Orchestrator â†’ Embedding Service:                                        â”‚
â”‚  POST /api/v1/investigations/search/semantic                                 â”‚
â”‚  {                                                                           â”‚
â”‚    "query": "AWS Credential Compromise admin@company.com Russia brute force",â”‚
â”‚    "tenant_id": "tenant-123",                                                â”‚
â”‚    "top_k": 5,                                                               â”‚
â”‚    "similarity_threshold": 0.75                                              â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  Embedding Service searches Qdrant 'investigations' collection:              â”‚
â”‚                                                                              â”‚
â”‚  Found 3 similar past investigations:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ 1. INC-12345 (Similarity: 0.91)                          â”‚              â”‚
â”‚  â”‚    "AWS Credential Theft - User bob@company.com"         â”‚              â”‚
â”‚  â”‚    Resolved: true_positive                               â”‚              â”‚
â”‚  â”‚    Classification: credential_theft                      â”‚              â”‚
â”‚  â”‚    Time to resolution: 45 minutes                        â”‚              â”‚
â”‚  â”‚                                                           â”‚              â”‚
â”‚  â”‚    Key Findings:                                         â”‚              â”‚
â”‚  â”‚    - Brute force from Russian IP                         â”‚              â”‚
â”‚  â”‚    - Successful login after 7 failed attempts            â”‚              â”‚
â”‚  â”‚    - Immediate privilege escalation                      â”‚              â”‚
â”‚  â”‚    - S3 data exfiltration                                â”‚              â”‚
â”‚  â”‚                                                           â”‚              â”‚
â”‚  â”‚    Actions Taken:                                        â”‚              â”‚
â”‚  â”‚    âœ“ Reset user password                                 â”‚              â”‚
â”‚  â”‚    âœ“ Revoked all active sessions                         â”‚              â”‚
â”‚  â”‚    âœ“ Blocked IP at firewall                              â”‚              â”‚
â”‚  â”‚    âœ“ Enabled MFA enforcement                             â”‚              â”‚
â”‚  â”‚    âœ“ Contacted user (confirmed compromise)               â”‚              â”‚
â”‚  â”‚                                                           â”‚              â”‚
â”‚  â”‚    Outcome: Contained in 45 min, no data loss            â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ 2. INC-23456 (Similarity: 0.84)                          â”‚              â”‚
â”‚  â”‚    Similar pattern, resolved in 60 minutes               â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ 3. INC-34567 (Similarity: 0.78)                          â”‚              â”‚
â”‚  â”‚    Similar pattern, resolved in 30 minutes               â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                              â”‚
â”‚  ğŸ’¡ AI will use these past cases to guide current investigation!             â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: SEND TO CLAUDE API (WITH ORGANIZATIONAL MEMORY)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Request to Claude Sonnet 4:                                                 â”‚
â”‚                                                                              â”‚
â”‚  System Prompt:                                                              â”‚
â”‚  """                                                                         â”‚
â”‚  You are a senior security analyst investigating incident INC-54321.         â”‚
â”‚                                                                              â”‚
â”‚  INCIDENT DETAILS:                                                           â”‚
â”‚  - Title: AWS Credential Compromise - admin@company.com                      â”‚
â”‚  - Severity: critical                                                        â”‚
â”‚  - Risk Score: 95/100                                                        â”‚
â”‚  - Affected User: admin@company.com                                          â”‚
â”‚  - Source IP: 185.220.101.45 (Russia)                                        â”‚
â”‚                                                                              â”‚
â”‚  CONTEXT GATHERED:                                                           â”‚
â”‚  1. Behavioral Analysis:                                                     â”‚
â”‚     - User normally logs in from USA only                                    â”‚
â”‚     - This is first login from Russia (NEVER seen before)                    â”‚
â”‚     - 5 failed attempts before success                                       â”‚
â”‚     - User risk score: 90/100 (critical)                                     â”‚
â”‚                                                                              â”‚
â”‚  2. Threat Intelligence:                                                     â”‚
â”‚     - IP 185.220.101.45 is MALICIOUS (0.89 confidence)                       â”‚
â”‚     - AbuseIPDB score: 87/100                                                â”‚
â”‚     - Tags: credential_stuffing, botnet                                      â”‚
â”‚     - 23 abuse reports in last 30 days                                       â”‚
â”‚                                                                              â”‚
â”‚  3. Attack Timeline:                                                         â”‚
â”‚     10:00 - Multiple failed SSH attempts (5 attempts)                        â”‚
â”‚     10:12 - Successful AWS Console login from Russia                         â”‚
â”‚     10:15 - Privilege escalation (AssumeRole to AdminRole)                   â”‚
â”‚     10:18 - S3 data access (47 files, 2.3 GB)                                â”‚
â”‚                                                                              â”‚
â”‚  4. Similar Past Incidents (YOUR ORGANIZATIONAL MEMORY):                     â”‚
â”‚     You've successfully resolved 3 similar incidents:                        â”‚
â”‚                                                                              â”‚
â”‚     Case INC-12345 (91% similar, resolved in 45 min):                        â”‚
â”‚     - Pattern: Brute force â†’ Login â†’ Privilege escalation â†’ Data theft      â”‚
â”‚     - Actions: Reset password, revoke sessions, block IP, enable MFA         â”‚
â”‚     - Outcome: Contained successfully, no data loss                          â”‚
â”‚                                                                              â”‚
â”‚     [... 2 more similar cases ...]                                           â”‚
â”‚                                                                              â”‚
â”‚  TASK:                                                                       â”‚
â”‚  Based on this context and your past experience with similar incidents,      â”‚
â”‚  provide:                                                                    â”‚
â”‚  1. Classification (credential_theft, data_exfiltration, etc.)               â”‚
â”‚  2. Resolution (true_positive or false_positive)                             â”‚
â”‚  3. Summary of the attack                                                    â”‚
â”‚  4. Key findings (list of critical observations)                             â”‚
â”‚  5. Recommended actions (based on what worked in past cases)                 â”‚
â”‚  6. Risk assessment (0-100)                                                  â”‚
â”‚  7. MITRE ATT&CK mapping                                                     â”‚
â”‚  """                                                                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: CLAUDE GENERATES INVESTIGATION REPORT                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Claude Response (2-3 seconds):                                              â”‚
â”‚                                                                              â”‚
â”‚  {                                                                           â”‚
â”‚    "classification": "credential_theft",                                     â”‚
â”‚    "resolution": "true_positive",                                            â”‚
â”‚    "risk_score": 95,                                                         â”‚
â”‚                                                                              â”‚
â”‚    "summary": "This is a confirmed credential compromise attack. The         â”‚
â”‚    attacker conducted a brute force attack from a known malicious IP in      â”‚
â”‚    Russia, successfully guessed admin@company.com's password after 5         â”‚
â”‚    attempts, immediately escalated privileges to AdminRole, and exfiltrated  â”‚
â”‚    2.3 GB of data from S3. The attack pattern matches 3 previous incidents   â”‚
â”‚    in your organization with 91% similarity.",                               â”‚
â”‚                                                                              â”‚
â”‚    "key_findings": [                                                         â”‚
â”‚      "Brute force attack from malicious IP 185.220.101.45 (Russia)",         â”‚
â”‚      "5 failed login attempts before successful compromise",                 â”‚
â”‚      "Login from never-before-seen country (0% baseline match)",             â”‚
â”‚      "Immediate privilege escalation to AdminRole (within 3 minutes)",       â”‚
â”‚      "Unauthorized S3 access: 47 files, 2.3 GB in sensitive-data-bucket",    â”‚
â”‚      "Attack timeline matches classic credential theft kill chain",          â”‚
â”‚      "IP has 87/100 abuse score with 23 recent abuse reports"                â”‚
â”‚    ],                                                                        â”‚
â”‚                                                                              â”‚
â”‚    "recommended_actions": [                                                  â”‚
â”‚      {                                                                       â”‚
â”‚        "action": "reset_password",                                           â”‚
â”‚        "priority": "immediate",                                              â”‚
â”‚        "reason": "Credentials are confirmed compromised",                    â”‚
â”‚        "execution": "Force password reset for admin@company.com"             â”‚
â”‚      },                                                                      â”‚
â”‚      {                                                                       â”‚
â”‚        "action": "revoke_sessions",                                          â”‚
â”‚        "priority": "immediate",                                              â”‚
â”‚        "reason": "Attacker may still have active sessions",                  â”‚
â”‚        "execution": "Revoke all active AWS sessions for this user"           â”‚
â”‚      },                                                                      â”‚
â”‚      {                                                                       â”‚
â”‚        "action": "block_ip",                                                 â”‚
â”‚        "priority": "immediate",                                              â”‚
â”‚        "reason": "Prevent continued access from malicious IP",               â”‚
â”‚        "execution": "Add 185.220.101.45 to WAF deny list"                    â”‚
â”‚      },                                                                      â”‚
â”‚      {                                                                       â”‚
â”‚        "action": "enable_mfa",                                               â”‚
â”‚        "priority": "high",                                                   â”‚
â”‚        "reason": "Prevent future credential-only compromises",               â”‚
â”‚        "execution": "Enforce MFA for all admin accounts"                     â”‚
â”‚      },                                                                      â”‚
â”‚      {                                                                       â”‚
â”‚        "action": "investigate_data_exfiltration",                            â”‚
â”‚        "priority": "high",                                                   â”‚
â”‚        "reason": "2.3 GB was accessed, determine sensitivity",               â”‚
â”‚        "execution": "Review S3 access logs for files downloaded"             â”‚
â”‚      },                                                                      â”‚
â”‚      {                                                                       â”‚
â”‚        "action": "contact_user",                                             â”‚
â”‚        "priority": "medium",                                                 â”‚
â”‚        "reason": "Confirm user was not traveling to Russia",                 â”‚
â”‚        "execution": "Email admin@company.com for travel confirmation"        â”‚
â”‚      }                                                                       â”‚
â”‚    ],                                                                        â”‚
â”‚                                                                              â”‚
â”‚    "mitre_attack": {                                                         â”‚
â”‚      "tactics": [                                                            â”‚
â”‚        "Initial Access",                                                     â”‚
â”‚        "Credential Access",                                                  â”‚
â”‚        "Privilege Escalation",                                               â”‚
â”‚        "Exfiltration"                                                        â”‚
â”‚      ],                                                                      â”‚
â”‚      "techniques": [                                                         â”‚
â”‚        "T1078 - Valid Accounts",                                             â”‚
â”‚        "T1110 - Brute Force",                                                â”‚
â”‚        "T1548 - Abuse Elevation Control Mechanism",                          â”‚
â”‚        "T1537 - Transfer Data to Cloud Account"                              â”‚
â”‚      ]                                                                       â”‚
â”‚    },                                                                        â”‚
â”‚                                                                              â”‚
â”‚    "estimated_time_to_contain": 45,  # minutes (learned from past cases!)    â”‚
â”‚    "confidence": 0.95                                                        â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: STORE INVESTIGATION IN QDRANT (FOR FUTURE LEARNING!) â­              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  AI Orchestrator â†’ Embedding Service:                                        â”‚
â”‚  POST /api/v1/investigations/store                                           â”‚
â”‚  {                                                                           â”‚
â”‚    "investigation_id": "INC-54321",                                          â”‚
â”‚    "tenant_id": "tenant-123",                                                â”‚
â”‚    "title": "AWS Credential Compromise - admin@company.com",                 â”‚
â”‚    "summary": "Confirmed credential compromise attack...",                   â”‚
â”‚    "classification": "credential_theft",                                     â”‚
â”‚    "resolution": "true_positive",                                            â”‚
â”‚    "risk_score": 95,                                                         â”‚
â”‚    "key_findings": [...],                                                    â”‚
â”‚    "recommended_actions": [...],                                             â”‚
â”‚    "mitre_tactics": [...],                                                   â”‚
â”‚    "mitre_techniques": [...],                                                â”‚
â”‚    "alert_ids": [ALT-98761, ALT-98762, ALT-98764, ALT-98765],                â”‚
â”‚    "time_to_resolution_minutes": null  # Will be updated when resolved       â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  Embedding Service:                                                          â”‚
â”‚  1. Generate 384-dim vector from investigation text                          â”‚
â”‚  2. Store in Qdrant 'investigations' collection                              â”‚
â”‚  3. Return success                                                           â”‚
â”‚                                                                              â”‚
â”‚  âœ… Investigation stored! Now available for future playbook recommendations  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: UPDATE INCIDENT IN POSTGRESQL                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Detection Engine:                                                           â”‚
â”‚  UPDATE incidents SET                                                        â”‚
â”‚    investigation_results = {                                                 â”‚
â”‚      "classification": "credential_theft",                                   â”‚
â”‚      "resolution": "true_positive",                                          â”‚
â”‚      "summary": "...",                                                       â”‚
â”‚      "key_findings": [...],                                                  â”‚
â”‚      "recommended_actions": [...],                                           â”‚
â”‚      "risk_score": 95,                                                       â”‚
â”‚      "investigated_by_type": "ai_agent",                                     â”‚
â”‚      "investigated_by_id": "investigation_agent_v1.3",                       â”‚
â”‚      "investigation_confidence": 0.95,                                       â”‚
â”‚      "agent_model_used": "claude-sonnet-4-5-20250929",                       â”‚
â”‚      "context_sources_used": [                                               â”‚
â”‚        "elasticsearch", "neo4j", "threat_intel", "qdrant", "detection_engine"â”‚
â”‚      ],                                                                      â”‚
â”‚      "timestamp": "2025-11-16 10:18:30"                                      â”‚
â”‚    },                                                                        â”‚
â”‚    status = 'open'  # Awaiting analyst review/action                         â”‚
â”‚  WHERE incident_id = 'INC-54321';                                            â”‚
â”‚                                                                              â”‚
â”‚  âœ… Incident updated with AI investigation!                                  â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“Š Total time: ~5 seconds from incident creation to investigation complete  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” The Learning Loop: How the System Gets Smarter

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ THE LEARNING CYCLE                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Day 1: First AWS Credential Compromise
  â†“
  â€¢ Detection Engine creates alert (no historical data)
  â€¢ AI investigates (no similar past investigations)
  â€¢ Analyst resolves incident in 90 minutes
  â€¢ Investigation stored in Qdrant
  â†“
  âœ… System learned: What credential theft looks like
  âœ… System learned: How it was resolved
  âœ… System learned: How long it took

Day 15: Second AWS Credential Compromise
  â†“
  â€¢ Detection Engine creates alert
  â€¢ Semantic search finds 1 similar past case (91% similarity)
  â€¢ Alert enriched with playbook from Day 1 investigation
  â€¢ AI investigates with context from past case
  â€¢ Analyst follows suggested steps, resolves in 60 minutes
  â€¢ Investigation stored in Qdrant
  â†“
  âœ… System learned: Pattern confirmed (2 cases)
  âœ… System learned: Playbook works
  âœ… System learned: Can resolve faster (60 min)

Day 45: Third AWS Credential Compromise
  â†“
  â€¢ Detection Engine creates alert
  â€¢ Semantic search finds 2 similar past cases (avg 88% similarity)
  â€¢ Alert enriched with refined playbook
  â€¢ Time prediction: 45 minutes (average of past cases)
  â€¢ AI investigates with context from 2 past cases
  â€¢ Analyst follows proven playbook, resolves in 45 minutes
  â€¢ Investigation stored in Qdrant
  â†“
  âœ… System learned: High-confidence pattern (3+ cases)
  âœ… System learned: Accurate time prediction
  âœ… System learned: Optimal response playbook

Day 90: Fourth AWS Credential Compromise
  â†“
  â€¢ Detection Engine creates alert
  â€¢ Semantic search finds 10+ similar past cases
  â€¢ CORRELATION RULE auto-created (learned pattern)
  â€¢ Alert auto-correlated with 3 related alerts â†’ Creates incident automatically
  â€¢ AI investigates with organizational memory of 10+ cases
  â€¢ Playbook confidence: 95%
  â€¢ Time prediction: 40 minutes (refined average)
  â€¢ Analyst follows well-tested playbook, resolves in 35 minutes
  â€¢ Investigation stored in Qdrant
  â†“
  âœ… System learned: Can auto-correlate this pattern
  âœ… System learned: Playbook is battle-tested
  âœ… System learned: Accurate predictions

Day 180: Tenth AWS Credential Compromise (Similar but Different)
  â†“
  â€¢ Detection Engine creates alert
  â€¢ Semantic search finds 15 similar past cases
  â€¢ NEW VARIATION: Attack came from USA instead of Russia
  â€¢ Threat intel: IP is clean (not malicious)
  â€¢ UEBA: Still extreme anomaly (failed attempts, unusual time)
  â€¢ Historical data: 90% of similar alerts from Russia were TP
  â€¢ Historical data: 10% of similar alerts from USA were FP
  â†“
  â€¢ AI analysis: "Despite clean IP and USA origin, behavioral
    anomalies and failed attempts match 15 past TPs. However,
    USA origin reduces confidence. Recommend analyst review."
  â€¢ Severity: high (not auto-escalated to critical)
  â€¢ Analyst reviews, confirms FP (employee traveling for business)
  â€¢ Marked as false_positive
  â€¢ Investigation stored in Qdrant with FP outcome
  â†“
  âœ… System learned: Not all credential attempts are malicious
  âœ… System learned: Geographic context matters
  âœ… System learned: Balance behavioral + threat intel + geography

Day 200: Eleventh AWS Credential Compromise (USA + Clean IP)
  â†“
  â€¢ Detection Engine creates alert
  â€¢ Semantic search finds 1 FP case + 15 TP cases
  â€¢ Geographic + threat intel + behavioral analysis
  â€¢ AI recommendation: "Low confidence TP. Suggest analyst review
    before taking action. 94% of similar cases were TP, but the
    1 FP case had identical geographic profile."
  â€¢ Analyst confirms TP (credential stuffing via VPN)
  â€¢ Investigation stored with refined context
  â†“
  âœ… System learned: Attackers use VPNs (don't rely only on geo)
  âœ… System learned: Nuanced decision-making

RESULT AFTER 6 MONTHS:
  â€¢ 40-60% of alerts auto-triaged (FP) with high confidence
  â€¢ 95%+ accurate playbook recommendations
  â€¢ 80%+ accurate time predictions
  â€¢ Auto-correlation rules for common attack patterns
  â€¢ Nuanced decision-making (considers edge cases)
  â€¢ Continuously improving with every analyst action
```

---

## ğŸ“š Data Storage: Where Everything Lives

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STORAGE LAYER BREAKDOWN                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚ 1. PostgreSQL (detection_db) - STRUCTURED DATA                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚    â”‚ Tables:                                                     â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ â€¢ alerts (40 columns)                                       â”‚           â”‚
â”‚    â”‚   - Core alert data                                         â”‚           â”‚
â”‚    â”‚   - JSONB fields: similar_alerts, recommended_playbooks,    â”‚           â”‚
â”‚    â”‚     behavioral_context, threat_intel_results, ueba_results  â”‚           â”‚
â”‚    â”‚   - 100K+ alerts/month                                      â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ â€¢ incidents (35 columns)                                    â”‚           â”‚
â”‚    â”‚   - Correlated incidents from multiple alerts               â”‚           â”‚
â”‚    â”‚   - JSONB field: investigation_results (AI analysis)        â”‚           â”‚
â”‚    â”‚   - 5K+ incidents/month                                     â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ â€¢ attack_campaigns (35 columns)                             â”‚           â”‚
â”‚    â”‚   - Multi-stage attack clusters                             â”‚           â”‚
â”‚    â”‚   - JSONB: attack_narrative, key_indicators                 â”‚           â”‚
â”‚    â”‚   - 200+ campaigns/month                                    â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ â€¢ learned_iocs (internal threat intel database)             â”‚           â”‚
â”‚    â”‚   - 5000+ IPs, domains, hashes                              â”‚           â”‚
â”‚    â”‚   - Confidence scores, tags, first/last seen                â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ â€¢ correlation_rules (auto-learned patterns)                 â”‚           â”‚
â”‚    â”‚   - Rules discovered from incident patterns                 â”‚           â”‚
â”‚    â”‚   - 50+ rules after 6 months                                â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ â€¢ behavioral_baselines (statistical summaries)              â”‚           â”‚
â”‚    â”‚   - User/IP/host baseline statistics                        â”‚           â”‚
â”‚    â”‚   - Refreshed weekly                                        â”‚           â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                               â”‚
â”‚ 2. Elasticsearch - FULL-TEXT SEARCH & RAW EVENTS                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚    â”‚ Indices:                                                    â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ â€¢ security-events-* (time-series, daily indices)            â”‚           â”‚
â”‚    â”‚   - All raw security events                                 â”‚           â”‚
â”‚    â”‚   - 1M+ events/day                                          â”‚           â”‚
â”‚    â”‚   - 30-day retention                                        â”‚           â”‚
â”‚    â”‚   - Used for: AI context gathering, analyst search          â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ â€¢ alerts-* (time-series)                                    â”‚           â”‚
â”‚    â”‚   - Denormalized alerts for fast search                     â”‚           â”‚
â”‚    â”‚   - Full-text search on all fields                          â”‚           â”‚
â”‚    â”‚   - 90-day retention                                        â”‚           â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                               â”‚
â”‚ 3. Qdrant - VECTOR SEARCH (AI LEARNING) â­                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚    â”‚ Collections (6 total):                                      â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ â€¢ {tenant_id}_alerts (384-dim vectors)                      â”‚           â”‚
â”‚    â”‚   - Every alert embedded for similarity search              â”‚           â”‚
â”‚    â”‚   - Powers: Auto-dismiss FP, playbook recommendations       â”‚           â”‚
â”‚    â”‚   - Size: 100K+ vectors/month                               â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ â€¢ investigations (384-dim vectors)                          â”‚           â”‚
â”‚    â”‚   - Completed investigation reports                         â”‚           â”‚
â”‚    â”‚   - Powers: Investigation playbooks, AI context             â”‚           â”‚
â”‚    â”‚   - Size: 5K+ vectors/month                                 â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ â€¢ iocs (384-dim vectors)                                    â”‚           â”‚
â”‚    â”‚   - Internal IOC database (semantic search)                 â”‚           â”‚
â”‚    â”‚   - Powers: IOC variant detection (e.g., evil.com variants) â”‚           â”‚
â”‚    â”‚   - Size: 5K+ vectors                                       â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ â€¢ entity_baselines (384-dim vectors)                        â”‚           â”‚
â”‚    â”‚   - User/IP/host behavioral baselines                       â”‚           â”‚
â”‚    â”‚   - Powers: UEBA anomaly detection                          â”‚           â”‚
â”‚    â”‚   - Size: 10K+ vectors (refreshed weekly)                   â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ â€¢ campaigns (384-dim vectors)                               â”‚           â”‚
â”‚    â”‚   - Attack campaign patterns                                â”‚           â”‚
â”‚    â”‚   - Powers: Campaign detection clustering                   â”‚           â”‚
â”‚    â”‚   - Size: 500+ vectors/month                                â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ â€¢ rule_performance (384-dim vectors)                        â”‚           â”‚
â”‚    â”‚   - Sigma rule performance metrics                          â”‚           â”‚
â”‚    â”‚   - Powers: Rule tuning recommendations                     â”‚           â”‚
â”‚    â”‚   - Size: 300+ vectors (one per rule)                       â”‚           â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                               â”‚
â”‚ 4. Neo4j - ENTITY RELATIONSHIP GRAPHS                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚    â”‚ Node Types:                                                 â”‚           â”‚
â”‚    â”‚   User, IP, Host, Process, File, Domain                    â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ Relationships:                                              â”‚           â”‚
â”‚    â”‚   LOGGED_IN_FROM, CONNECTED_TO, EXECUTED, ACCESSED          â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ Powers:                                                     â”‚           â”‚
â”‚    â”‚   - "Show me all IPs this user connected from"              â”‚           â”‚
â”‚    â”‚   - "Who else accessed this host?"                          â”‚           â”‚
â”‚    â”‚   - "Find lateral movement patterns"                        â”‚           â”‚
â”‚    â”‚   - Risk score calculation (0-100)                          â”‚           â”‚
â”‚    â”‚                                                              â”‚           â”‚
â”‚    â”‚ Size: 1M+ nodes, 10M+ relationships                         â”‚           â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                               â”‚
â”‚ 5. Redis - CACHING & RATE LIMITING                                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚    â”‚ â€¢ API rate limiting (50 calls/60s per tenant)               â”‚           â”‚
â”‚    â”‚ â€¢ Embedding cache (avoid re-encoding same text)             â”‚           â”‚
â”‚    â”‚ â€¢ Session management                                        â”‚           â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Key Performance Metrics

| Metric | Value | Impact |
|--------|-------|--------|
| **Noise Reduction** | 40-60% alerts auto-triaged | Analysts focus on real threats |
| **Investigation Speed** | 5 seconds (AI) vs 30-60 min (manual) | 360-720x faster initial triage |
| **Time Prediction Accuracy** | 90%+ after 50 cases | Better resource planning |
| **Playbook Availability** | 80%+ of alerts after 3 months | Faster response |
| **Campaign Detection** | 20-40% more multi-stage attacks | Catch sophisticated threats |
| **Correlation Accuracy** | 85%+ after learning | Auto-incident creation |
| **Context Gathering Time** | 2-3 seconds (5 sources parallel) | Real-time investigation |
| **False Positive Rate** | Reduced by 50-70% after 6 months | Higher alert quality |

---

## ğŸ” Security & Multi-Tenancy

```
Every API call enforces tenant isolation:

1. Authentication (auth-service)
   â†“
2. Tenant ID extraction from JWT
   â†“
3. Middleware validates tenant access
   â†“
4. Database queries filtered by tenant_id:
   - PostgreSQL: WHERE tenant_id = 'tenant-123'
   - Qdrant: filter={"tenant_id": "tenant-123"}
   - Neo4j: MATCH (n {tenant_id: 'tenant-123'})
   - Elasticsearch: query.filter.term.tenant_id = 'tenant-123'
   â†“
5. Zero data leakage between tenants
```

---

## ğŸ“ˆ Continuous Learning CronJobs

| Job | Schedule | Purpose |
|-----|----------|---------|
| **phase1-learning-daily** | 2 AM daily | Auto-dismiss FP learning, severity tuning |
| **baseline-learning-weekly** | Sunday 3 AM | Refresh UEBA baselines |
| **campaign-detection-hourly** | Every hour | Detect multi-stage attacks |
| **automated-ioc-extraction** | Every 6 hours | Extract IOCs from TP incidents |

---

## ğŸ¨ Frontend Integration (AI Chat + Dynamic Content)

```
User Chat Input: "Show me critical alerts from today"
  â†“
WebSocket â†’ AI Orchestrator
  â†“
AI Orchestrator:
  1. Uses tool: list_alerts(severity="critical", time_range="24h")
  2. Retrieves 4 critical alerts with all enrichments
  3. Generates conversational response
  â†“
WebSocket Response:
  {
    "role": "assistant",
    "content": "I found 4 critical alerts from today. 2 are confirmed true positives requiring immediate action...",
    "content_type": "alert_list",  â† Tells frontend what to render
    "data": {
      "alerts": [
        {
          "alert_id": "ALT-98765",
          "title": "Suspicious AWS Console Login",
          "severity": "critical",
          "confidence": 0.92,
          "auto_dismiss_reasoning": "...",
          "recommended_playbooks": {...},
          "behavioral_context": {...},
          "threat_intel_results": [...],
          "ueba_results": {...}
        }
      ]
    },
    "follow_up_questions": [
      "Investigate alert ALT-98765",
      "Show me the user's behavioral baseline",
      "Check IP reputation"
    ]
  }
  â†“
Frontend:
  1. Shows AI message in chat sidebar (30%)
  2. Renders AlertListView component in main area (70%)
  3. Each alert card shows:
     - AI confidence score
     - Auto-dismiss reasoning (if applicable)
     - Recommended playbook (if available)
     - Behavioral anomalies
     - Threat intel verdict
     - Quick action buttons
  4. Shows follow-up question chips
```

---

## ğŸš€ Competitive Advantages

### Traditional SIEM vs. SecOps AI Platform

| Feature | Traditional SIEM | SecOps AI Platform |
|---------|------------------|-------------------|
| **Alert Triage** | 100% manual | 40-60% automated (AI) |
| **Investigation Time** | 30-60 minutes | 5 seconds (AI initial triage) |
| **Playbooks** | Static, manually created | Learned from past investigations |
| **Campaign Detection** | Manual correlation | AI-powered clustering (hourly) |
| **Learning** | None | Continuous (every alert/investigation) |
| **Time Prediction** | None | 90%+ accurate after 50 cases |
| **Behavioral Baselines** | Static rules | ML-powered, auto-updated weekly |
| **IOC Detection** | Exact match only | Semantic search (catches variants) |
| **Correlation Rules** | Manually written | Auto-learned from incidents |
| **Investigation Memory** | None | Qdrant stores all past investigations |

---

## ğŸ“ Summary for Client Presentation

**Elevator Pitch:**

"SecOps AI Platform is an AI-first SIEM that learns from your security team. Every alert it processes, every investigation your analysts complete, and every incident you resolve makes the system smarter.

Within 6 months, it will:
- Auto-triage 40-60% of false positives
- Recommend proven playbooks for 80%+ of alerts
- Predict investigation time with 90%+ accuracy
- Detect multi-stage attacks that span hours or days
- Auto-correlate alerts into incidents

The more you use it, the better it gets. It's not just a SIEMâ€”it's your security team's AI-powered memory."

---

**End of Document**

*For technical deep-dive, see:*
- `/home/user/secops-ai/docs/detection-pipeline/02-DETECTION-ENGINE.md`
- `/home/user/secops-ai/docs/detection-pipeline/IMPLEMENTATION_SUMMARY_NOV16.md`
- `/home/user/secops-ai/services/*/README.md`
